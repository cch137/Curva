var on=Object.defineProperty;var rn=(e,t,r)=>t in e?on(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var ye=(e,t,r)=>(rn(e,typeof t!="symbol"?t+"":t,r),r);import{q as Et,ah as sn,b2 as Ct,p as ot,M as an,l as St,bY as ln,aZ as Bt,bZ as rt,w as J,b_ as cn,aB as un,b$ as fn,aA as dn,bH as $e,I as ve,aH as hn,b as vn,a as st,j as Tt,C as Q,ai as Ye,az as mn,H as pn,E as gn,c0 as yn,c1 as wn,m as re,r as z,S as Ke,c2 as at,aV as it,at as bn,aD as se,o as j,c as F,y as Y,aq as Le,t as X,v as O,F as lt,G as we,s as Oe,z as be,A as ae,B as ue,x as Ee,N as De,aE as Ne,ax as En,f as At,c3 as _t,c4 as Mt,ay as ct,an as Cn,al as Sn,aF as ut,bu as ft,c5 as Bn,c6 as ee,c7 as xt,L as dt,c8 as Tn,P as kt,a3 as An,O as G,aK as me,c9 as Xe,aJ as ht}from"./entry.28e04e0d.js";import{E as _n}from"./el-button.48c848c4.js";import{t as Mn,E as xn}from"./el-input.fdaab1b7.js";import{u as Ce}from"./useTitle.3de0a53a.js";import{E as kn,i as Rn}from"./focus-trap.8572fd17.js";import{a as Hn}from"./scroll.7fa0bb6a.js";const In='a[href],button:not([disabled]),button:not([hidden]),:not([tabindex="-1"]),input:not([disabled]),input:not([type="hidden"]),select:not([disabled]),textarea:not([disabled])',$n=e=>getComputedStyle(e).position==="fixed"?!1:e.offsetParent!==null,vt=e=>Array.from(e.querySelectorAll(In)).filter(t=>Ln(t)&&$n(t)),Ln=e=>{if(e.tabIndex>0||e.tabIndex===0&&e.getAttribute("tabIndex")!==null)return!0;if(e.disabled)return!1;switch(e.nodeName){case"A":return!!e.href&&e.rel!=="ignore";case"INPUT":return!(e.type==="hidden"||e.type==="file");case"BUTTON":case"SELECT":case"TEXTAREA":return!0;default:return!1}};var _e=(e=>(e[e.TEXT=1]="TEXT",e[e.CLASS=2]="CLASS",e[e.STYLE=4]="STYLE",e[e.PROPS=8]="PROPS",e[e.FULL_PROPS=16]="FULL_PROPS",e[e.HYDRATE_EVENTS=32]="HYDRATE_EVENTS",e[e.STABLE_FRAGMENT=64]="STABLE_FRAGMENT",e[e.KEYED_FRAGMENT=128]="KEYED_FRAGMENT",e[e.UNKEYED_FRAGMENT=256]="UNKEYED_FRAGMENT",e[e.NEED_PATCH=512]="NEED_PATCH",e[e.DYNAMIC_SLOTS=1024]="DYNAMIC_SLOTS",e[e.HOISTED=-1]="HOISTED",e[e.BAIL=-2]="BAIL",e))(_e||{});const On=(e,t,r)=>{let s={offsetX:0,offsetY:0};const l=E=>{const A=E.clientX,n=E.clientY,{offsetX:_,offsetY:B}=s,w=e.value.getBoundingClientRect(),R=w.left,k=w.top,C=w.width,y=w.height,S=document.documentElement.clientWidth,a=document.documentElement.clientHeight,m=-R+_,o=-k+B,u=S-R-C+_,p=a-k-y+B,v=b=>{const M=Math.min(Math.max(_+b.clientX-A,m),u),T=Math.min(Math.max(B+b.clientY-n,o),p);s={offsetX:M,offsetY:T},e.value.style.transform=`translate(${ot(M)}, ${ot(T)})`},x=()=>{document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",x)};document.addEventListener("mousemove",v),document.addEventListener("mouseup",x)},i=()=>{t.value&&e.value&&t.value.addEventListener("mousedown",l)},g=()=>{t.value&&e.value&&t.value.removeEventListener("mousedown",l)};Et(()=>{sn(()=>{r.value?i():g()})}),Ct(()=>{g()})},Dn=(e,t={})=>{an(e)||Mn("[useLockscreen]","You need to pass a ref param to this function");const r=t.ns||St("popup"),s=ln(()=>r.bm("parent","hidden"));if(!Bt||rt(document.body,s.value))return;let l=0,i=!1,g="0";const E=()=>{setTimeout(()=>{dn(document==null?void 0:document.body,s.value),i&&document&&(document.body.style.width=g)},200)};J(e,A=>{if(!A){E();return}i=!rt(document.body,s.value),i&&(g=document.body.style.width),l=Hn(r.namespace.value);const n=document.documentElement.clientHeight<document.body.scrollHeight,_=cn(document.body,"overflowY");l>0&&(n||_==="scroll")&&i&&(document.body.style.width=`calc(100% - ${l}px)`),un(document.body,s.value)}),fn(()=>E())},Rt=e=>{if(!e)return{onClick:$e,onMousedown:$e,onMouseup:$e};let t=!1,r=!1;return{onClick:g=>{t&&r&&e(g),t=r=!1},onMousedown:g=>{t=g.target===g.currentTarget},onMouseup:g=>{r=g.target===g.currentTarget}}},Fe="_trap-focus-children",te=[],mt=e=>{if(te.length===0)return;const t=te[te.length-1][Fe];if(t.length>0&&e.code===hn.tab){if(t.length===1){e.preventDefault(),document.activeElement!==t[0]&&t[0].focus();return}const r=e.shiftKey,s=e.target===t[0],l=e.target===t[t.length-1];s&&r&&(e.preventDefault(),t[t.length-1].focus()),l&&!r&&(e.preventDefault(),t[0].focus())}},Nn={beforeMount(e){e[Fe]=vt(e),te.push(e),te.length<=1&&document.addEventListener("keydown",mt)},updated(e){ve(()=>{e[Fe]=vt(e)})},unmounted(){te.shift(),te.length===0&&document.removeEventListener("keydown",mt)}},zn=vn({mask:{type:Boolean,default:!0},customMaskEvent:{type:Boolean,default:!1},overlayClass:{type:st([String,Array,Object])},zIndex:{type:st([String,Number])}}),Wn={click:e=>e instanceof MouseEvent},Un="overlay";var Pn=Tt({name:"ElOverlay",props:zn,emits:Wn,setup(e,{slots:t,emit:r}){const s=St(Un),l=A=>{r("click",A)},{onClick:i,onMousedown:g,onMouseup:E}=Rt(e.customMaskEvent?void 0:l);return()=>e.mask?Q("div",{class:[s.b(),e.overlayClass],style:{zIndex:e.zIndex},onClick:i,onMousedown:g,onMouseup:E},[Ye(t,"default")],_e.STYLE|_e.CLASS|_e.PROPS,["onClick","onMouseup","onMousedown"]):mn("div",{class:e.overlayClass,style:{zIndex:e.zIndex,position:"fixed",top:"0px",right:"0px",bottom:"0px",left:"0px"}},[Ye(t,"default")])}});const Vn=Pn,qn=Tt({name:"ElMessageBox",directives:{TrapFocus:Nn},components:{ElButton:_n,ElFocusTrap:kn,ElInput:xn,ElOverlay:Vn,ElIcon:gn,...yn},inheritAttrs:!1,props:{buttonSize:{type:String,validator:Rn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:t}){const{locale:r,zIndex:s,ns:l,size:i}=wn("message-box",re(()=>e.buttonSize)),{t:g}=r,{nextZIndex:E}=s,A=z(!1),n=Ke({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:null,inputValidator:null,inputErrorMessage:"",message:null,modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:E()}),_=re(()=>{const I=n.type;return{[l.bm("icon",I)]:I&&at[I]}}),B=it(),w=it(),R=re(()=>n.icon||at[n.type]||""),k=re(()=>!!n.message),C=z(),y=z(),S=z(),a=z(),m=z(),o=re(()=>n.confirmButtonClass);J(()=>n.inputValue,async I=>{await ve(),e.boxType==="prompt"&&I!==null&&T()},{immediate:!0}),J(()=>A.value,I=>{var $,N;I&&(e.boxType!=="prompt"&&(n.autofocus?S.value=(N=($=m.value)==null?void 0:$.$el)!=null?N:C.value:S.value=C.value),n.zIndex=E()),e.boxType==="prompt"&&(I?ve().then(()=>{var L;a.value&&a.value.$el&&(n.autofocus?S.value=(L=H())!=null?L:C.value:S.value=C.value)}):(n.editorErrorMessage="",n.validateError=!1))});const u=re(()=>e.draggable);On(C,y,u),Et(async()=>{await ve(),e.closeOnHashChange&&window.addEventListener("hashchange",p)}),Ct(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",p)});function p(){A.value&&(A.value=!1,ve(()=>{n.action&&t("action",n.action)}))}const v=()=>{e.closeOnClickModal&&M(n.distinguishCancelAndClose?"close":"cancel")},x=Rt(v),b=I=>{if(n.inputType!=="textarea")return I.preventDefault(),M("confirm")},M=I=>{var $;e.boxType==="prompt"&&I==="confirm"&&!T()||(n.action=I,n.beforeClose?($=n.beforeClose)==null||$.call(n,I,n,p):p())},T=()=>{if(e.boxType==="prompt"){const I=n.inputPattern;if(I&&!I.test(n.inputValue||""))return n.editorErrorMessage=n.inputErrorMessage||g("el.messagebox.error"),n.validateError=!0,!1;const $=n.inputValidator;if(typeof $=="function"){const N=$(n.inputValue);if(N===!1)return n.editorErrorMessage=n.inputErrorMessage||g("el.messagebox.error"),n.validateError=!0,!1;if(typeof N=="string")return n.editorErrorMessage=N,n.validateError=!0,!1}}return n.editorErrorMessage="",n.validateError=!1,!0},H=()=>{const I=a.value.$refs;return I.input||I.textarea},U=()=>{M("close")},P=()=>{e.closeOnPressEscape&&U()};return e.lockScroll&&Dn(A),{...bn(n),ns:l,overlayEvent:x,visible:A,hasMessage:k,typeClass:_,contentId:B,inputId:w,btnSize:i,iconComponent:R,confirmButtonClasses:o,rootRef:C,focusStartRef:S,headerRef:y,inputRef:a,confirmRef:m,doClose:p,handleClose:U,onCloseRequested:P,handleWrapperClick:v,handleInputEnter:b,handleAction:M,t:g}}}),jn=["aria-label","aria-describedby"],Yn=["aria-label"],Xn=["id"];function Fn(e,t,r,s,l,i){const g=se("el-icon"),E=se("close"),A=se("el-input"),n=se("el-button"),_=se("el-focus-trap"),B=se("el-overlay");return j(),F(En,{name:"fade-in-linear",onAfterLeave:t[11]||(t[11]=w=>e.$emit("vanish")),persisted:""},{default:Y(()=>[Le(Q(B,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:Y(()=>[X("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:O(`${e.ns.namespace.value}-overlay-message-box`),onClick:t[8]||(t[8]=(...w)=>e.overlayEvent.onClick&&e.overlayEvent.onClick(...w)),onMousedown:t[9]||(t[9]=(...w)=>e.overlayEvent.onMousedown&&e.overlayEvent.onMousedown(...w)),onMouseup:t[10]||(t[10]=(...w)=>e.overlayEvent.onMouseup&&e.overlayEvent.onMouseup(...w))},[Q(_,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:Y(()=>[X("div",{ref:"rootRef",class:O([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:lt(e.customStyle),tabindex:"-1",onClick:t[7]||(t[7]=we(()=>{},["stop"]))},[e.title!==null&&e.title!==void 0?(j(),Oe("div",{key:0,ref:"headerRef",class:O(e.ns.e("header"))},[X("div",{class:O(e.ns.e("title"))},[e.iconComponent&&e.center?(j(),F(g,{key:0,class:O([e.ns.e("status"),e.typeClass])},{default:Y(()=>[(j(),F(be(e.iconComponent)))]),_:1},8,["class"])):ae("v-if",!0),X("span",null,ue(e.title),1)],2),e.showClose?(j(),Oe("button",{key:0,type:"button",class:O(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:t[0]||(t[0]=w=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel")),onKeydown:t[1]||(t[1]=Ee(we(w=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"]))},[Q(g,{class:O(e.ns.e("close"))},{default:Y(()=>[Q(E)]),_:1},8,["class"])],42,Yn)):ae("v-if",!0)],2)):ae("v-if",!0),X("div",{id:e.contentId,class:O(e.ns.e("content"))},[X("div",{class:O(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(j(),F(g,{key:0,class:O([e.ns.e("status"),e.typeClass])},{default:Y(()=>[(j(),F(be(e.iconComponent)))]),_:1},8,["class"])):ae("v-if",!0),e.hasMessage?(j(),Oe("div",{key:1,class:O(e.ns.e("message"))},[Ye(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(j(),F(be(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(j(),F(be(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:Y(()=>[De(ue(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):ae("v-if",!0)],2),Le(X("div",{class:O(e.ns.e("input"))},[Q(A,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":t[2]||(t[2]=w=>e.inputValue=w),type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:O({invalid:e.validateError}),onKeydown:Ee(e.handleInputEnter,["enter"])},null,8,["id","modelValue","type","placeholder","aria-invalid","class","onKeydown"]),X("div",{class:O(e.ns.e("errormsg")),style:lt({visibility:e.editorErrorMessage?"visible":"hidden"})},ue(e.editorErrorMessage),7)],2),[[Ne,e.showInput]])],10,Xn),X("div",{class:O(e.ns.e("btns"))},[e.showCancelButton?(j(),F(n,{key:0,loading:e.cancelButtonLoading,class:O([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:t[3]||(t[3]=w=>e.handleAction("cancel")),onKeydown:t[4]||(t[4]=Ee(we(w=>e.handleAction("cancel"),["prevent"]),["enter"]))},{default:Y(()=>[De(ue(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","class","round","size"])):ae("v-if",!0),Le(Q(n,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,class:O([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:t[5]||(t[5]=w=>e.handleAction("confirm")),onKeydown:t[6]||(t[6]=Ee(we(w=>e.handleAction("confirm"),["prevent"]),["enter"]))},{default:Y(()=>[De(ue(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","class","round","disabled","size"]),[[Ne,e.showConfirmButton]])],2)],6)]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,jn)]),_:3},8,["z-index","overlay-class","mask"]),[[Ne,e.visible]])]),_:3})}var Gn=pn(qn,[["render",Fn],["__file","/home/runner/work/element-plus/element-plus/packages/components/message-box/src/index.vue"]]);const pe=new Map,Kn=e=>{let t=document.body;return e.appendTo&&(At(e.appendTo)&&(t=document.querySelector(e.appendTo)),ft(e.appendTo)&&(t=e.appendTo),ft(t)||(t=document.body)),t},Qn=(e,t,r=null)=>{const s=Q(Gn,e,ut(e.message)||_t(e.message)?{default:ut(e.message)?e.message:()=>e.message}:null);return s.appContext=r,Mt(s,t),Kn(e).appendChild(t.firstElementChild),s.component},Jn=()=>document.createElement("div"),Zn=(e,t)=>{const r=Jn();e.onVanish=()=>{Mt(null,r),pe.delete(l)},e.onAction=i=>{const g=pe.get(l);let E;e.showInput?E={value:l.inputValue,action:i}:E=i,e.callback?e.callback(E,s.proxy):i==="cancel"||i==="close"?e.distinguishCancelAndClose&&i!=="cancel"?g.reject("close"):g.reject("cancel"):g.resolve(E)};const s=Qn(e,r,t),l=s.proxy;for(const i in e)ct(e,i)&&!ct(l.$props,i)&&(l[i]=e[i]);return l.visible=!0,l};function ce(e,t=null){if(!Bt)return Promise.reject();let r;return At(e)||_t(e)?e={message:e}:r=e.callback,new Promise((s,l)=>{const i=Zn(e,t??ce._context);pe.set(i,{options:e,callback:r,resolve:s,reject:l})})}const eo=["alert","confirm","prompt"],to={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};eo.forEach(e=>{ce[e]=no(e)});function no(e){return(t,r,s,l)=>{let i="";return Cn(r)?(s=r,i=""):Sn(r)?i="":i=r,ce(Object.assign({title:i,message:t,type:"",...to[e]},s,{boxType:e}),l)}}ce.close=()=>{pe.forEach((e,t)=>{t.doClose()}),pe.clear()};ce._context=null;const K=ce;K.install=e=>{K._context=e._context,e.config.globalProperties.$msgbox=K,e.config.globalProperties.$messageBox=K,e.config.globalProperties.$alert=K.alert,e.config.globalProperties.$confirm=K.confirm,e.config.globalProperties.$prompt=K.prompt};const ze=K,oo={},ro=Object.freeze(Object.defineProperty({__proto__:null,default:oo},Symbol.toStringTag,{value:"Module"})),so=Bn(ro);async function ie(e=0){return await new Promise((t,r)=>{setTimeout(()=>{try{window.scrollTo(0,document.body.scrollHeight),t(null)}catch(s){r(s)}},+e||0)})}const ao={get isMobileScreen(){return window.innerWidth<600},get isTouchScreen(){return"ontouchstart"in document||navigator.maxTouchPoints>0}};function pt(){return ao}const gt="web-browsing",yt="temperature-suffix",Ie=e=>(e==null?void 0:e.toString)===void 0?"":e.toString(),io=e=>Ie(e).toLowerCase(),Ht="01",It="0123456789",$t="0123456789abcdef",Lt="0123456789abcdefghijklmnopqrstuvwxyz",Ot="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",ne="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Dt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",Ge=e=>{switch(typeof e!="string"&&(e=io(e)),e){case"2":return Ht;case"10":return It;case"16":return $t;case"36":return Lt;case"62":return Ot;case"64":return ne;case"64w":case"64+":return Dt;default:return e}},lo=(e,t,r,s=0)=>{typeof e!="string"&&(e=Ie(e));let l=BigInt(0);t=Ge(t);const i=t.length;for(let E=0;E<e.length;E++)l+=BigInt(t.indexOf(e[E])*Math.pow(i,e.length-1-E));let g="";if(r=Ge(r),g===""){const E=BigInt(r.length);for(;l>0;)g=r.charAt(+BigInt(l%E).toString())+g,l=BigInt(l/E)}return(g===""?r.charAt(0):g).padStart(s,r[0])},co=e=>{const t=e.split("").map(i=>i.charCodeAt(0)),r=[];let s=0;for(;s<t.length;){const[i,g=0,E=0]=t.slice(s,s+=3),A=(i<<16)+(g<<8)+E,n=A>>18,_=A>>12&63,B=A>>6&63,w=A&63;r.push(ne[n],ne[_],ne[B],ne[w])}const l=t.length%3;return r.join("").slice(0,1+r.length-l)+(l===2?"==":l===1?"=":"")},uo=/[^A-Za-z0-9+/]/g,Nt=e=>e.replace(uo,""),We=e=>String.fromCharCode(+e),fo=e=>{const t=Nt(e).split(""),r=[];let s=0;for(;s<t.length;){const[l,i,g,E]=t.slice(s,s+=4).map(A=>ne.indexOf(A));r.push(We(l<<2|i>>4)),g!==64&&r.push(We((i&15)<<4|g>>2)),E!==64&&r.push(We((g&3)<<6|E))}return r.join("").replaceAll("\0","")},le={BASE2_CHARSET:Ht,BASE10_CHARSET:It,BASE16_CHARSET:$t,BASE36_CHARSET:Lt,BASE62_CHARSET:Ot,BASE64_CHARSET:ne,BASE64WEB_CHARSET:Dt,convert:lo,getCharset:Ge,secureBase64:Nt,textToBase64:co,base64ToText:fo};var zt={exports:{}};function ho(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ue={exports:{}},wt;function Qe(){return wt||(wt=1,function(e,t){(function(r,s){e.exports=s()})(ee,function(){var r=r||function(s,l){var i;if(typeof window<"u"&&window.crypto&&(i=window.crypto),typeof self<"u"&&self.crypto&&(i=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(i=globalThis.crypto),!i&&typeof window<"u"&&window.msCrypto&&(i=window.msCrypto),!i&&typeof ee<"u"&&ee.crypto&&(i=ee.crypto),!i&&typeof ho=="function")try{i=so}catch{}var g=function(){if(i){if(typeof i.getRandomValues=="function")try{return i.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof i.randomBytes=="function")try{return i.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},E=Object.create||function(){function a(){}return function(m){var o;return a.prototype=m,o=new a,a.prototype=null,o}}(),A={},n=A.lib={},_=n.Base=function(){return{extend:function(a){var m=E(this);return a&&m.mixIn(a),(!m.hasOwnProperty("init")||this.init===m.init)&&(m.init=function(){m.$super.init.apply(this,arguments)}),m.init.prototype=m,m.$super=this,m},create:function(){var a=this.extend();return a.init.apply(a,arguments),a},init:function(){},mixIn:function(a){for(var m in a)a.hasOwnProperty(m)&&(this[m]=a[m]);a.hasOwnProperty("toString")&&(this.toString=a.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),B=n.WordArray=_.extend({init:function(a,m){a=this.words=a||[],m!=l?this.sigBytes=m:this.sigBytes=a.length*4},toString:function(a){return(a||R).stringify(this)},concat:function(a){var m=this.words,o=a.words,u=this.sigBytes,p=a.sigBytes;if(this.clamp(),u%4)for(var v=0;v<p;v++){var x=o[v>>>2]>>>24-v%4*8&255;m[u+v>>>2]|=x<<24-(u+v)%4*8}else for(var b=0;b<p;b+=4)m[u+b>>>2]=o[b>>>2];return this.sigBytes+=p,this},clamp:function(){var a=this.words,m=this.sigBytes;a[m>>>2]&=4294967295<<32-m%4*8,a.length=s.ceil(m/4)},clone:function(){var a=_.clone.call(this);return a.words=this.words.slice(0),a},random:function(a){for(var m=[],o=0;o<a;o+=4)m.push(g());return new B.init(m,a)}}),w=A.enc={},R=w.Hex={stringify:function(a){for(var m=a.words,o=a.sigBytes,u=[],p=0;p<o;p++){var v=m[p>>>2]>>>24-p%4*8&255;u.push((v>>>4).toString(16)),u.push((v&15).toString(16))}return u.join("")},parse:function(a){for(var m=a.length,o=[],u=0;u<m;u+=2)o[u>>>3]|=parseInt(a.substr(u,2),16)<<24-u%8*4;return new B.init(o,m/2)}},k=w.Latin1={stringify:function(a){for(var m=a.words,o=a.sigBytes,u=[],p=0;p<o;p++){var v=m[p>>>2]>>>24-p%4*8&255;u.push(String.fromCharCode(v))}return u.join("")},parse:function(a){for(var m=a.length,o=[],u=0;u<m;u++)o[u>>>2]|=(a.charCodeAt(u)&255)<<24-u%4*8;return new B.init(o,m)}},C=w.Utf8={stringify:function(a){try{return decodeURIComponent(escape(k.stringify(a)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(a){return k.parse(unescape(encodeURIComponent(a)))}},y=n.BufferedBlockAlgorithm=_.extend({reset:function(){this._data=new B.init,this._nDataBytes=0},_append:function(a){typeof a=="string"&&(a=C.parse(a)),this._data.concat(a),this._nDataBytes+=a.sigBytes},_process:function(a){var m,o=this._data,u=o.words,p=o.sigBytes,v=this.blockSize,x=v*4,b=p/x;a?b=s.ceil(b):b=s.max((b|0)-this._minBufferSize,0);var M=b*v,T=s.min(M*4,p);if(M){for(var H=0;H<M;H+=v)this._doProcessBlock(u,H);m=u.splice(0,M),o.sigBytes-=T}return new B.init(m,T)},clone:function(){var a=_.clone.call(this);return a._data=this._data.clone(),a},_minBufferSize:0});n.Hasher=y.extend({cfg:_.extend(),init:function(a){this.cfg=this.cfg.extend(a),this.reset()},reset:function(){y.reset.call(this),this._doReset()},update:function(a){return this._append(a),this._process(),this},finalize:function(a){a&&this._append(a);var m=this._doFinalize();return m},blockSize:16,_createHelper:function(a){return function(m,o){return new a.init(o).finalize(m)}},_createHmacHelper:function(a){return function(m,o){return new S.HMAC.init(a,o).finalize(m)}}});var S=A.algo={};return A}(Math);return r})}(Ue)),Ue.exports}var Pe={exports:{}},bt;function vo(){return bt||(bt=1,function(e,t){(function(r,s){e.exports=s(Qe())})(ee,function(r){return function(s){var l=r,i=l.lib,g=i.Base,E=i.WordArray,A=l.x64={};A.Word=g.extend({init:function(n,_){this.high=n,this.low=_}}),A.WordArray=g.extend({init:function(n,_){n=this.words=n||[],_!=s?this.sigBytes=_:this.sigBytes=n.length*8},toX32:function(){for(var n=this.words,_=n.length,B=[],w=0;w<_;w++){var R=n[w];B.push(R.high),B.push(R.low)}return E.create(B,this.sigBytes)},clone:function(){for(var n=g.clone.call(this),_=n.words=this.words.slice(0),B=_.length,w=0;w<B;w++)_[w]=_[w].clone();return n}})}(),r})}(Pe)),Pe.exports}(function(e,t){(function(r,s,l){e.exports=s(Qe(),vo())})(ee,function(r){return function(s){var l=r,i=l.lib,g=i.WordArray,E=i.Hasher,A=l.x64,n=A.Word,_=l.algo,B=[],w=[],R=[];(function(){for(var y=1,S=0,a=0;a<24;a++){B[y+5*S]=(a+1)*(a+2)/2%64;var m=S%5,o=(2*y+3*S)%5;y=m,S=o}for(var y=0;y<5;y++)for(var S=0;S<5;S++)w[y+5*S]=S+(2*y+3*S)%5*5;for(var u=1,p=0;p<24;p++){for(var v=0,x=0,b=0;b<7;b++){if(u&1){var M=(1<<b)-1;M<32?x^=1<<M:v^=1<<M-32}u&128?u=u<<1^113:u<<=1}R[p]=n.create(v,x)}})();var k=[];(function(){for(var y=0;y<25;y++)k[y]=n.create()})();var C=_.SHA3=E.extend({cfg:E.cfg.extend({outputLength:512}),_doReset:function(){for(var y=this._state=[],S=0;S<25;S++)y[S]=new n.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(y,S){for(var a=this._state,m=this.blockSize/2,o=0;o<m;o++){var u=y[S+2*o],p=y[S+2*o+1];u=(u<<8|u>>>24)&16711935|(u<<24|u>>>8)&4278255360,p=(p<<8|p>>>24)&16711935|(p<<24|p>>>8)&4278255360;var v=a[o];v.high^=p,v.low^=u}for(var x=0;x<24;x++){for(var b=0;b<5;b++){for(var M=0,T=0,H=0;H<5;H++){var v=a[b+5*H];M^=v.high,T^=v.low}var U=k[b];U.high=M,U.low=T}for(var b=0;b<5;b++)for(var P=k[(b+4)%5],I=k[(b+1)%5],$=I.high,N=I.low,M=P.high^($<<1|N>>>31),T=P.low^(N<<1|$>>>31),H=0;H<5;H++){var v=a[b+5*H];v.high^=M,v.low^=T}for(var L=1;L<25;L++){var M,T,v=a[L],V=v.high,q=v.low,c=B[L];c<32?(M=V<<c|q>>>32-c,T=q<<c|V>>>32-c):(M=q<<c-32|V>>>64-c,T=V<<c-32|q>>>64-c);var f=k[w[L]];f.high=M,f.low=T}var d=k[0],h=a[0];d.high=h.high,d.low=h.low;for(var b=0;b<5;b++)for(var H=0;H<5;H++){var L=b+5*H,v=a[L],Ze=k[L],et=k[(b+1)%5+5*H],tt=k[(b+2)%5+5*H];v.high=Ze.high^~et.high&tt.high,v.low=Ze.low^~et.low&tt.low}var v=a[0],nt=R[x];v.high^=nt.high,v.low^=nt.low}},_doFinalize:function(){var y=this._data,S=y.words;this._nDataBytes*8;var a=y.sigBytes*8,m=this.blockSize*32;S[a>>>5]|=1<<24-a%32,S[(s.ceil((a+1)/m)*m>>>5)-1]|=128,y.sigBytes=S.length*4,this._process();for(var o=this._state,u=this.cfg.outputLength/8,p=u/8,v=[],x=0;x<p;x++){var b=o[x],M=b.high,T=b.low;M=(M<<8|M>>>24)&16711935|(M<<24|M>>>8)&4278255360,T=(T<<8|T>>>24)&16711935|(T<<24|T>>>8)&4278255360,v.push(T),v.push(M)}return new g.init(v,u)},clone:function(){for(var y=E.clone.call(this),S=y._state=this._state.slice(0),a=0;a<25;a++)S[a]=S[a].clone();return y}});l.SHA3=E._createHelper(C),l.HmacSHA3=E._createHmacHelper(C)}(Math),r.SHA3})})(zt);var mo=zt.exports;const Wt=xt(mo);function po(...e){return e.reduce((t,r)=>t+r,0)}function go(e){try{return typeof e[Symbol==null?void 0:Symbol.iterator]=="function"}catch{return!1}}function Ut(e){const t=new Set;return JSON.stringify(e,(s,l)=>{if(typeof l=="object"&&l!==null){if(t.has(l))return;t.add(l),go(l)&&(l=[...l])}return l})}const yo=e=>Wt(e,{outputLength:256}).toString(),wo=/0b[0-1]+/i;function ge(e){if(typeof e=="number")return Math.round(e);if(e instanceof Object&&(e=Ut(e)),typeof e=="string"){if(wo.test(e))return parseInt(e.substring(2,e.length-1),2);const t=parseInt(e);return Number.isNaN(t)?t:po(parseInt(yo(e),16))}else return Date.now()}const D=624,Se=397,bo=2567483615,Ve=2147483648,qe=2147483647;class Eo{constructor(t){ye(this,"mt",new Array(D));ye(this,"mti",D+1);ye(this,"seed");return this.seed=t=ge(t),Array.isArray(t)?this.init_by_array(t,t.length):this.init_seed(t),this}init_seed(t){for(this.mt[0]=t>>>0,this.mti=1;this.mti<D;this.mti++)t=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(((t&4294901760)>>>16)*1812433253<<16)+(t&65535)*1812433253+this.mti,this.mt[this.mti]>>>=0}init_by_array(t,r){let s,l,i;for(this.init_seed(19650218),s=1,l=0,i=D>r?D:r;i!==0;i--){const g=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(((g&4294901760)>>>16)*1664525<<16)+(g&65535)*1664525)+t[l]+l,this.mt[s]>>>=0,s++,l++,s>=D&&(this.mt[0]=this.mt[D-1],s=1),l>=r&&(l=0)}for(i=D-1;i!==0;i--){const g=this.mt[s-1]^this.mt[s-1]>>>30;this.mt[s]=(this.mt[s]^(((g&4294901760)>>>16)*1566083941<<16)+(g&65535)*1566083941)-s,this.mt[s]>>>=0,s++,s>=D&&(this.mt[0]=this.mt[D-1],s=1)}this.mt[0]=2147483648}random_int(){let t;const r=new Array(0,bo);if(this.mti>=D){let s;for(this.mti===D+1&&this.init_seed(5489),s=0;s<D-Se;s++)t=this.mt[s]&Ve|this.mt[s+1]&qe,this.mt[s]=this.mt[s+Se]^t>>>1^r[t&1];for(;s<D-1;s++)t=this.mt[s]&Ve|this.mt[s+1]&qe,this.mt[s]=this.mt[s+(Se-D)]^t>>>1^r[t&1];t=this.mt[D-1]&Ve|this.mt[0]&qe,this.mt[D-1]=this.mt[Se-1]^t>>>1^r[t&1],this.mti=0}return t=this.mt[this.mti++],t^=t>>>11,t^=t<<7&2636928640,t^=t<<15&4022730752,t^=t>>>18,t>>>0}random_int31(){return this.random_int()>>>1}random_incl(){return this.random_int()*(1/4294967295)}random(){return this.random_int()*(1/4294967296)}random_excl(){return(this.random_int()+.5)*(1/4294967296)}random_long(){return((this.random_int()>>>5)*67108864+(this.random_int()>>>6))*(1/9007199254740992)}}function Pt(e){return new Eo(e)}const{BASE10_CHARSET:Co,BASE16_CHARSET:So,BASE64WEB_CHARSET:Bo}=le,To=Pt(),Vt=(e=To)=>e.random(),Je=(e,t,r)=>((t===void 0||t===0)&&(t=e,e=0),Math.floor(e+Vt(r)*t)),qt=(e,t)=>e[Je(0,e.length,t)],jt=(e,t=1,r)=>{const s=[],l=[];for(let i=0;i<t;i++)l.length===0&&l.push(...e),s.push(l.splice(Je(0,l.length,r),1)[0]);return s},Ao=(e,t)=>jt(e,e.length,t),Be=(e,t=8,r)=>new Array(t).fill(0).map(s=>qt(e,r)).join(""),Yt={MT:Pt,toSeed:ge,rand:Vt,randInt:Je,charset:Be,choice:qt,choices:jt,shuffle:Ao,base10:(e=6,t)=>Be(Co,e,t),base16:(e=32,t)=>Be(So,e,t),base64:(e=32,t)=>Be(Bo,e,t),lcg(e){let t=ge(e);return()=>(t=(t*1664525+1013904223)%4294967296)/4294967296}};var Xt={exports:{}};(function(e,t){(function(r,s){e.exports=s(Qe())})(ee,function(r){return function(s){var l=r,i=l.lib,g=i.WordArray,E=i.Hasher,A=l.algo,n=[];(function(){for(var C=0;C<64;C++)n[C]=s.abs(s.sin(C+1))*4294967296|0})();var _=A.MD5=E.extend({_doReset:function(){this._hash=new g.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(C,y){for(var S=0;S<16;S++){var a=y+S,m=C[a];C[a]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360}var o=this._hash.words,u=C[y+0],p=C[y+1],v=C[y+2],x=C[y+3],b=C[y+4],M=C[y+5],T=C[y+6],H=C[y+7],U=C[y+8],P=C[y+9],I=C[y+10],$=C[y+11],N=C[y+12],L=C[y+13],V=C[y+14],q=C[y+15],c=o[0],f=o[1],d=o[2],h=o[3];c=B(c,f,d,h,u,7,n[0]),h=B(h,c,f,d,p,12,n[1]),d=B(d,h,c,f,v,17,n[2]),f=B(f,d,h,c,x,22,n[3]),c=B(c,f,d,h,b,7,n[4]),h=B(h,c,f,d,M,12,n[5]),d=B(d,h,c,f,T,17,n[6]),f=B(f,d,h,c,H,22,n[7]),c=B(c,f,d,h,U,7,n[8]),h=B(h,c,f,d,P,12,n[9]),d=B(d,h,c,f,I,17,n[10]),f=B(f,d,h,c,$,22,n[11]),c=B(c,f,d,h,N,7,n[12]),h=B(h,c,f,d,L,12,n[13]),d=B(d,h,c,f,V,17,n[14]),f=B(f,d,h,c,q,22,n[15]),c=w(c,f,d,h,p,5,n[16]),h=w(h,c,f,d,T,9,n[17]),d=w(d,h,c,f,$,14,n[18]),f=w(f,d,h,c,u,20,n[19]),c=w(c,f,d,h,M,5,n[20]),h=w(h,c,f,d,I,9,n[21]),d=w(d,h,c,f,q,14,n[22]),f=w(f,d,h,c,b,20,n[23]),c=w(c,f,d,h,P,5,n[24]),h=w(h,c,f,d,V,9,n[25]),d=w(d,h,c,f,x,14,n[26]),f=w(f,d,h,c,U,20,n[27]),c=w(c,f,d,h,L,5,n[28]),h=w(h,c,f,d,v,9,n[29]),d=w(d,h,c,f,H,14,n[30]),f=w(f,d,h,c,N,20,n[31]),c=R(c,f,d,h,M,4,n[32]),h=R(h,c,f,d,U,11,n[33]),d=R(d,h,c,f,$,16,n[34]),f=R(f,d,h,c,V,23,n[35]),c=R(c,f,d,h,p,4,n[36]),h=R(h,c,f,d,b,11,n[37]),d=R(d,h,c,f,H,16,n[38]),f=R(f,d,h,c,I,23,n[39]),c=R(c,f,d,h,L,4,n[40]),h=R(h,c,f,d,u,11,n[41]),d=R(d,h,c,f,x,16,n[42]),f=R(f,d,h,c,T,23,n[43]),c=R(c,f,d,h,P,4,n[44]),h=R(h,c,f,d,N,11,n[45]),d=R(d,h,c,f,q,16,n[46]),f=R(f,d,h,c,v,23,n[47]),c=k(c,f,d,h,u,6,n[48]),h=k(h,c,f,d,H,10,n[49]),d=k(d,h,c,f,V,15,n[50]),f=k(f,d,h,c,M,21,n[51]),c=k(c,f,d,h,N,6,n[52]),h=k(h,c,f,d,x,10,n[53]),d=k(d,h,c,f,I,15,n[54]),f=k(f,d,h,c,p,21,n[55]),c=k(c,f,d,h,U,6,n[56]),h=k(h,c,f,d,q,10,n[57]),d=k(d,h,c,f,T,15,n[58]),f=k(f,d,h,c,L,21,n[59]),c=k(c,f,d,h,b,6,n[60]),h=k(h,c,f,d,$,10,n[61]),d=k(d,h,c,f,v,15,n[62]),f=k(f,d,h,c,P,21,n[63]),o[0]=o[0]+c|0,o[1]=o[1]+f|0,o[2]=o[2]+d|0,o[3]=o[3]+h|0},_doFinalize:function(){var C=this._data,y=C.words,S=this._nDataBytes*8,a=C.sigBytes*8;y[a>>>5]|=128<<24-a%32;var m=s.floor(S/4294967296),o=S;y[(a+64>>>9<<4)+15]=(m<<8|m>>>24)&16711935|(m<<24|m>>>8)&4278255360,y[(a+64>>>9<<4)+14]=(o<<8|o>>>24)&16711935|(o<<24|o>>>8)&4278255360,C.sigBytes=(y.length+1)*4,this._process();for(var u=this._hash,p=u.words,v=0;v<4;v++){var x=p[v];p[v]=(x<<8|x>>>24)&16711935|(x<<24|x>>>8)&4278255360}return u},clone:function(){var C=E.clone.call(this);return C._hash=this._hash.clone(),C}});function B(C,y,S,a,m,o,u){var p=C+(y&S|~y&a)+m+u;return(p<<o|p>>>32-o)+y}function w(C,y,S,a,m,o,u){var p=C+(y&a|S&~a)+m+u;return(p<<o|p>>>32-o)+y}function R(C,y,S,a,m,o,u){var p=C+(y^S^a)+m+u;return(p<<o|p>>>32-o)+y}function k(C,y,S,a,m,o,u){var p=C+(S^(y|~a))+m+u;return(p<<o|p>>>32-o)+y}l.MD5=E._createHelper(_),l.HmacMD5=E._createHmacHelper(_)}(Math),r.MD5})})(Xt);var _o=Xt.exports;const Mo=xt(_o),{MT:He,shuffle:xo,randInt:Me}=Yt,{convert:Ft,getCharset:Gt}=le,Kt=(e,t)=>{const r=xo(e,t);return()=>(r.push(r.shift()),r)},Qt=(e,t=16,r=1,s)=>{const l=Number.isNaN(+t)?64:+t,i=Gt(t),g=ge(s!==void 0?s:Me(0,l)),E=He(g),A=Kt(i,He(Me(0,1e6,E))),n=typeof e=="string"?e.split(""):e,_=[s!==void 0?i[Me(0,l)]:Ft(g,10,t),...n.map(B=>A()[i.indexOf(B)])];return--r<1?_.join(""):Qt(_,t,r,s)},Jt=(e,t=16,r=1,s)=>{const l=Gt(t),i=ge(s!==void 0?s:+Ft(e[0],t,10)),g=He(i),E=Kt(l,He(Me(0,1e6,g))),n=(typeof e=="string"?e.split(""):e).slice(1,e.length).map(_=>l[E().indexOf(_)]);return--r<1?n.join(""):Jt(n,t,r,s)},{textToBase64:ko,base64ToText:Ro,secureBase64:Ho}=le;function Zt(e,t=1,r){return typeof e=="object"?e=Ut(e):typeof e!="string"&&(e=Ie(e)),Qt(Ho(ko(e)),64,t,r)}function Io(e,t=1,r,s=!0){if(e=Ro(Jt(e,64,t,r)),!s)return e;try{return JSON.parse(e)}catch{return e}}function $o(e,t=512,r){const s=Zt(e,1,r).substring(1);return t==="MD5"?Mo(s).toString():Wt(s,{outputLength:t}).toString()}const Lo={e:Zt,d:Io,h:$o},en=z("gpt4"),Oo=4e3,Do=()=>{if(!nn.value)return"";const e=W.value.filter(r=>r.done).map(r=>(r.Q?`Question:
${r.Q}`:"")+(r.Q&&r.A?`

`:"")+(r.A?`Answer:
${r.A}`:""));for(;e.length>1&&e.slice(1,e.length).join("").length>Oo;)e.shift();const t=e.join(`
---
`);return t.length===0?"":(e.push(),`Conversation History
===
${t}`)},No=["OFF","BASIC","ADVANCED"],zo="OFF",xe=z(zo),W=z([]),oe=z([]),fe=()=>{try{document.querySelector(".InputBox textarea").focus()}catch{}},Te=()=>new Promise((e,t)=>{$fetch("/api/chat/check",{method:"POST"}).then(r=>{const{list:s,named:l}=r;oe.value=s.sort().map(i=>({id:i,name:l[i]})),e(!0)}).catch(r=>{G.error("Initialization Failed"),t(r)})}),Wo=e=>new Promise(async(t,r)=>{if(e==null)return t([]);const s=await $fetch("/api/chat/history",{method:"POST",body:{id:e}});(!s||s.length===0)&&me("/c/");try{t(s.map(l=>Ke({...l,t:new Date(l.t),done:!!l.A})))}catch{me("/c/"),t([])}}),tn=async function(e){return await $fetch("/api/chat/suggestions",{method:"POST",body:{question:e}})},Uo=async()=>{try{const e=W.value.at(-1),t=await tn(e.Q),r=Xe()>=document.body.clientHeight;e.more=t,r&&ie()}catch(e){console.error(e)}},Po="_t05",ke=z(Po),nn=z(!0),Z=z(!1),de=z(Z.value),he=z(Z.value),Ae=z(""),Vo=(()=>{const{h:e}=Lo,t=()=>`${en.value}${ke.value}`,r=()=>xe.value,s=()=>[77,68,53].map(g=>String.fromCharCode(g)).join(""),l=(g,E,A)=>({hash:e(`${g}${E}`,s(),A),timestamp:Ie(A)}),i=(g,E,A,n,_,B)=>{var R,k;let w=(k=(R=kt()._route)==null?void 0:R.params)==null?void 0:k.conv;return w||(w=Yt.base64(8),oe.value.push({id:w,name:void 0}),me(`/c/${w}?feature=new`)),{conv:w,context:Do(),prompt:g,model:E,web:A,t:n,tz:_,id:B}};return(g,E)=>{const A=new Date,n=A.getTime(),_=A.getTimezoneOffset()/60*-1,B=i(g,t(),r(),n,_,E),w=l(g,B.context,n);return $fetch("/api/chat/answer",{method:"POST",headers:w,body:B})}})(),qo=(e="",t="",r=!1)=>Ke({done:r,Q:e,A:t,queries:[],urls:[],dt:void 0,t:new Date});let je=new Set;const jo=()=>{oe.value=[],W.value=[],me("/c/"),Re=!0};let Re=!0;function Zo(){const e=dt("appName").value,t=Tn(),r=t.get(gt);No.includes(r)&&(xe.value=r);const s=t.get(yt)||"";/_t(?:0[0-9]|10)/.test(s)&&(ke.value=s),J(xe,o=>{typeof o=="string"&&t.set(gt,o,{path:"/"})}),J(ke,o=>{t.set(yt,o,{path:"/"})});const l=kt(),i=()=>{var o,u;return(u=(o=l._route)==null?void 0:o.params)==null?void 0:u.conv},g=()=>{const o=i();return oe.value.filter(u=>u.id===o)[0].name||""};J(Z,o=>{pt().isMobileScreen?(de.value=!1,he.value!==o&&(he.value=o)):(he.value=!1,de.value!==o&&(de.value=o)),setTimeout(()=>{try{fe()}catch{}},0)}),J(he,o=>{Z.value=o}),J(de,o=>{Z.value=o});const E=async o=>{pt().isMobileScreen&&(Z.value=!1),W.value=[];const u=ht.service();try{const v=(await Promise.all([o===null&&oe.value.length>0?null:Te(),o===null?null:Wo(o)]))[1];v!==null&&i()===o&&(W.value=v,Uo())}finally{try{Ce(`${g()||"Chat"} - ${e}`)}catch{Ce(`Chat - ${e}`)}if(ie(),u!==null)try{await ie(500)}finally{u.close()}}setTimeout(()=>fe(),500)},A=async(o,u=!1)=>{const p=Promise.all([...je]);console.log(Re,u);const v=Re&&u?new Promise(x=>x(me("/c/"))):u?new Promise(x=>x(null)):E(o);Re=!1,je.add(v);try{await p}catch{}try{await v}finally{je.delete(v)}},n=An().t,_=dt("version"),B=(o,u)=>{if(document.querySelectorAll(".Message.T").length>0)return G.info("Thinking too many questions."),!1;const v=o===void 0?Ae.value:o,x=v.trim();v===Ae.value&&(Ae.value="");const b=qo(x,"",!1);W.value.push(b),ie(),setTimeout(()=>{fe()},500);const M=tn(x);return Vo(x,u).then(T=>{const H=Xe()>=document.body.clientHeight,U=T.id,P=T.answer,I=T.urls,$=T.queries,N=T.dt,L="complete"in T?T.complete:!0,V=T.version;if(L||G.warning(n("error.qTooLong")),!P)throw n("error.plzRefresh");b.id=U,b.A=P,b.urls=I||[],b.queries=$||[],b.dt=N||void 0,V!==_.value&&ze.confirm(n("action.newVersion"),n("message.notice"),{confirmButtonText:n("message.ok"),cancelButtonText:n("message.cancel"),type:"warning"}).then(()=>{location.reload()}).finally(()=>{fe()}),H&&ie(),M.then(q=>{const c=Xe()>=document.body.clientHeight;b.more=q,c&&ie()}).catch(()=>{})}).catch(T=>{G.error(T||"Oops! Something went wrong!"),b.A="Oops! Something went wrong!"}).finally(()=>{b.done=!0,b.t=new Date}),!0},w=async()=>{const o=W.value.pop();o!==void 0&&(B(o.Q,o.id)||W.value.push(o))},R=o=>{W.value=W.value.filter(u=>u.id!==o),$fetch("/api/chat/answer",{method:"DELETE",body:{conv:i(),id:o}}).then(()=>G.info("The message has been deleted.")).catch(()=>G.error("An error occurred while deleting the message."))},k=()=>{A(i())},C=(o,u="")=>{o||(o=i(),u=g()),ze.prompt(n("message.renameConvHint"),n("message.setting"),{confirmButtonText:n("message.ok"),cancelButtonText:n("message.cancel"),inputValue:u,inputPlaceholder:le.convert(o,"64w",10)}).then(({value:p})=>{$fetch("/api/chat/conv",{method:"PUT",body:{id:o,name:p}}).then(async()=>{G({type:"success",message:n("message.renameSuccess")}),await Te();try{Ce(`${g()||"Chat"} - ${e}`)}catch{Ce(`Chat - ${e}`)}}).catch(()=>{G({type:"error",message:"Oops! Something went wrong!"})})}).catch(()=>{})},y=o=>{var b,M;const u=o||i(),p=[...oe.value];let v=-1,x="createNewChat";for(let T=0;T<p.length;T++)if(p[T].id===u){v=T;break}if(v!==-1){const T=(b=p[v-1])==null?void 0:b.id,H=(M=p[v+1])==null?void 0:M.id;T!==void 0?x=T:H!==void 0&&(x=H)}ze.confirm(n("message.deleteConvConfirm"),n("message.warning"),{confirmButtonText:n("message.ok"),cancelButtonText:n("message.cancel"),type:"warning"}).then(()=>{const T=ht.service();$fetch("/api/chat/conv",{method:"DELETE",body:{id:u}}).finally(async()=>{var H;T.close(),o===i()?(H=document.getElementById(x))==null||H.click():await Te()})})},S=(o,u)=>{const p=document.createElement("a");p.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(u)),p.setAttribute("download",o),p.style.display="none",document.body.appendChild(p),p.click(),p.remove()};return{model:en,conversations:oe,messages:W,webBrowsingMode:xe,temperatureSuffix:ke,contextMode:nn,openMenu:Z,openSidebar:de,openDrawer:he,inputValue:Ae,getCurrentConvId:i,getCurrentConvName:g,checkTokenAndGetConversations:Te,loadChat:A,sendMessage:B,deleteMessage:R,regenerateMessage:w,focusInput:fe,refreshConversation:k,renameConversation:C,deleteConversation:y,exportAsMarkdown:()=>{let o=0;const u=`${le.convert(i(),"64w",10)}.md`,p=W.value.map(v=>{o++;try{return(v.t?`${new Date(v.t.getTime()-(v.dt||0)).toLocaleString()}${v.dt===void 0?"":" (Δt: "+v.dt.toString()+"ms)"}

`:"")+(v.Q?`QUESTION ${o}:

${v.Q.replaceAll(`
`,`

`)}`:"")+(v.Q&&v.A?`

`:"")+(v.A?`ANSWER ${o}:

${v.A}`:"")}catch{return"(Unknown message)"}}).join(`

---

`)+`

---

`;S(u,p)},exportAsJson:()=>{S(`${le.convert(i(),"64w",10)}.json`,JSON.stringify(W.value.map(o=>({question:o.Q,answer:o.A,created:new Date(o.t.getTime()).toUTCString(),timeUsed:o.dt||void 0,queries:o.queries||void 0,urls:o.urls||void 0})),null,4))},clear:jo}}export{ze as E,Dn as a,Vn as b,le as c,pt as d,Yt as r,Ie as s,Zo as u};
