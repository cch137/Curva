import{r as u,aJ as g,a3 as v,P as c,O as s,aK as p}from"./entry.734770b0.js";import{u as L}from"./useChat.41516e89.js";const e=u(!1),t=u(!1),y=async()=>{e.value=!0;try{await $fetch("/api/auth/logout",{method:"POST"}),t.value=!1,s.success("Logged out."),L().clear()}catch{s.error("Log out failed.")}finally{e.value=!1}};let r=0;const i=async()=>{const a=Date.now();if(a-r<6e4)return t.value;e.value=!0;try{const l=(await $fetch("/api/auth/check",{method:"POST"})).isLoggedIn;return r=a,t.value=l,e.value=!1,l}catch{e.value=!1}};(async()=>{const a=g.service();try{await i()}finally{a.close()}})();function I(){const a=v().t;return{isLoading:e,isLoggedIn:t,login:(n,h)=>{const f=g.service({text:a("auth.loggingIn")});e.value=!0,$fetch("/api/auth/login",{method:"POST",body:{usernameOrEmail:n,password:h}}).then(d=>{const o=d;o!=null&&o.error?s.error(o==null?void 0:o.error):(s.success("Logged in."),p("/c/"),t.value=!0)}).catch(()=>{s.error("Oops! Something went wrong.")}).finally(()=>{f.close(),e.value=!1})},logout:y,checkIsLoggedIn:i,setIsLoggedIn(n){t.value=n},goToHome(){c().$router.replace("/")},goToNewChat(){c().$router.replace("/c/")}}}export{I as u};
