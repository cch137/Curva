import{E as N}from"./el-input.c6bfcfd5.js";import{E as O,a as M,_ as U}from"./el-form.c026d687.js";import{j as W,a1 as P,r as k,Q as $,M as j,o as d,c as x,y as n,C as o,t as c,B as f,F as D,u as e,s as C,A as h,O as y,a2 as p,aI as I,aJ as H,E as J,aK as K,aL as Q,T as G,a3 as X,aM as Y}from"./entry.6021dbec.js";import{E as Z}from"./el-link.250e5da2.js";import{E as ee}from"./el-text.775813df.js";import{E as te}from"./el-button.b6a7aac3.js";import{_ as ae}from"./nuxt-link.0cca69d3.js";import{_ as se}from"./client-only.f487ec80.js";/* empty css                */import{E as oe}from"./useChat.34e10ef1.js";import{u as re}from"./useAuth.6f87f240.js";import{u as le}from"./useTitle.a08f3ffa.js";import"./isEqual.ba7a6dc3.js";import"./el-select.a8036333.js";import"./el-popper.d9f8bb24.js";import"./focus-trap.a7143051.js";const ne={class:"mt-0 mb-6"},ie={key:0,class:"-mt-1 mb-2 w-full text-right"},ue={key:4,class:"flex-center flex-col gap-1 w-full"},me={class:"flex justify-end gap-1 w-full"},pe=c("div",{class:"p-6"},null,-1),ce={key:5,class:"flex-center"},de={key:6,class:"flex-center"},fe=c("div",{class:"p-2"},null,-1),ge={class:"flex-center flex-col gap-1"},_e={class:"flex-center gap-1"},he=c("div",{class:"p-8"},null,-1),ye={class:"absolute w-screen flex-center gap-2 p-3",style:{bottom:"0"}},ve={style:{width:"120px"}},Ne=W({__name:"signup",setup(xe){const S=re(),t=P().t,V=k(!1),i=k(0),w=k(),r=$({email:"",username:"",password:"",veriCode:""}),z=$({email:[{required:!0,message:t("auth.emailRequired"),trigger:"change"},{type:"email",message:t("auth.emailInvalid"),trigger:"change"}],username:[{required:!0,message:t("auth.usernameRequired"),trigger:"change"},{min:5,max:32,message:t("auth.usernameLength"),trigger:"change"}],password:[{required:!0,message:t("auth.passwdRequired"),trigger:"change"},{min:8,max:64,message:t("auth.passwdLength"),trigger:"change"}],veriCode:[{required:!0,message:t("auth.veriCodeRequired"),trigger:"change"},{min:6,max:6,message:t("auth.veriCodeRequired"),trigger:"change"}]}),L=()=>{oe.confirm(t("auth.confirmChangeEmail"),"",{confirmButtonText:t("message.ok"),cancelButtonText:t("message.cancel"),type:"warning"}).then(()=>{i.value=0,r.email="",r.veriCode="",p.success(t("action.opExecuted"))}).catch(()=>{p.info(t("action.opCanceled"))})},q=()=>{V.value=!0,E(w.value,!0)},E=async(l,a=!1)=>{await l.validate((g,_)=>{if(g||a){const v=I.service({text:t("auth.sendingVeriCode")});$fetch(a?"/api/auth/resendCode":"/api/auth/createVerification",{method:"POST",body:{email:r.email}}).then(u=>{const m=u;m!=null&&m.error?p.error(m==null?void 0:m.error):(p.success("Email sent, please check your inbox."),i.value=1)}).catch(()=>{p.error("Oops! Something went wrong.")}).finally(()=>{v.close()})}else p.error(t("auth.formIncomplete"))})},A=async l=>{await l.validate((a,g)=>{if(a){const _=I.service({text:t("auth.sendingVeriCode")});$fetch("/api/auth/signup",{method:"POST",body:{email:r.email,username:r.username,password:r.password,code:r.veriCode}}).then(v=>{const u=v;u!=null&&u.error?p.error(u==null?void 0:u.error):(p.success("Sign up successful."),H("/c/"),S.setIsLoggedIn(!0))}).catch(()=>{p.error("Oops! Something went wrong.")}).finally(()=>{_.close()})}else p.error(t("auth.formIncomplete"))})};return le(`${t("auth.signup")} - ${j("appName").value}`),(l,a)=>{const g=N,_=O,v=J,u=Z,m=ee,b=te,B=ae,T=M,R=U,F=se;return d(),x(F,null,{default:n(()=>[o(T,{ref_key:"ruleFormRef",ref:w,model:e(r),rules:e(z),"label-position":"top",class:"flex-col flex-center w-full max-w-xs px-4 m-auto",style:{height:"calc(100vh - 56px)"}},{default:n(()=>[c("h1",ne,f(l.$t("auth.signup")),1),o(_,{label:l.$t("auth.email"),style:D(e(i)===1?"margin-bottom: 0;":""),prop:"email",class:"inputWrapper SignupInputAnim1"},{default:n(()=>[(d(),x(g,{key:e(i),modelValue:e(r).email,"onUpdate:modelValue":a[0]||(a[0]=s=>e(r).email=s),type:"email",size:"large","prefix-icon":e(K),readonly:e(i)>0,disabled:e(i)>0},null,8,["modelValue","prefix-icon","readonly","disabled"]))]),_:1},8,["label","style"]),e(i)===1?(d(),C("div",ie,[o(u,{type:"primary",onClick:L,style:{"font-size":"small"}},{default:n(()=>[o(v,{size:"small",class:"mr-1"},{default:n(()=>[o(e(Q))]),_:1}),c("span",null,f(l.$t("action.change")),1)]),_:1})])):h("",!0),e(i)===1?(d(),x(_,{key:1,label:l.$t("auth.username"),prop:"username",class:"inputWrapper SignupInputAnim1"},{default:n(()=>[o(g,{modelValue:e(r).username,"onUpdate:modelValue":a[1]||(a[1]=s=>e(r).username=s),type:"text",size:"large","prefix-icon":e(G),formatter:s=>s.replace(/[^\w]+/g,""),parser:s=>s.replace(/[^\w]+/g,"")},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(i)===1?(d(),x(_,{key:2,label:l.$t("auth.passwd"),prop:"password",class:"inputWrapper SignupInputAnim2 SignupPasswordInputWrapper"},{default:n(()=>[o(g,{modelValue:e(r).password,"onUpdate:modelValue":a[2]||(a[2]=s=>e(r).password=s),type:"password",size:"large","prefix-icon":e(X),formatter:s=>s.trim(),parser:s=>s.trim(),"show-password":""},null,8,["modelValue","prefix-icon","formatter","parser"])]),_:1},8,["label"])):h("",!0),e(i)===1?(d(),x(_,{key:3,label:l.$t("auth.veriCode"),prop:"veriCode",class:"inputWrapper SignupInputAnim2"},{default:n(()=>[o(g,{modelValue:e(r).veriCode,"onUpdate:modelValue":a[3]||(a[3]=s=>e(r).veriCode=s),type:"text",size:"large",maxLength:"6","prefix-icon":e(Y)},null,8,["modelValue","prefix-icon"])]),_:1},8,["label"])):h("",!0),e(i)===1&&!e(V)?(d(),C("div",ue,[c("div",me,[o(m,{type:"info",style:{"font-size":"small"}},{default:n(()=>[y(f(l.$t("auth.notReceiveVeriCode")),1)]),_:1}),o(u,{type:"primary",style:{"font-size":"small"},onClick:q},{default:n(()=>[y(f(l.$t("action.resend")),1)]),_:1})])])):h("",!0),pe,e(i)===0?(d(),C("div",ce,[o(b,{size:"large",type:"primary",onClick:a[4]||(a[4]=s=>E(e(w)))},{default:n(()=>[y(f(l.$t("auth.getVeriCode")),1)]),_:1})])):h("",!0),e(i)===1?(d(),C("div",de,[o(b,{size:"large",type:"primary",onClick:a[5]||(a[5]=s=>A(e(w)))},{default:n(()=>[y(f(l.$t("auth.signup")),1)]),_:1})])):h("",!0),fe,c("div",ge,[c("div",_e,[o(m,{type:"info"},{default:n(()=>[y(f(l.$t("auth.alreadyHaveAnAcc")),1)]),_:1}),o(u,{type:"primary"},{default:n(()=>[o(B,{to:"/login"},{default:n(()=>[y(f(l.$t("auth.login")),1)]),_:1})]),_:1})])]),he]),_:1},8,["model","rules"]),c("div",ye,[o(m,{type:"info",class:"opacity-75"},{default:n(()=>[y("More languages:")]),_:1}),c("span",ve,[o(R,{size:"small"})])])]),_:1})}}});export{Ne as default};
